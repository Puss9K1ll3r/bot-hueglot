import openpyxl
from zipfile import ZipFile
import os

def OpenXlsxFile(fileName):
    file = openpyxl.open(fileName, read_only=True)
    return file

def GetIndexOfDay(sheet):
    daysOfWeek = ["понедельник", "вторник", "среда", "четверг", "пятница", "суббота"]
    daysNum = 0
    dayIndex = list()
    for row in range(1, sheet.max_row + 1):
        if sheet[row][0].value:
            if daysOfWeek[daysNum] in sheet[row][0].value.lower():
                daysNum += 1
                dayIndex.append(row)
            if daysNum > 5:
                break

    row = dayIndex[5]
    while sheet[row][1].value:
        row += 1
    dayIndex.append(row)
    return dayIndex

def Redactor(list, sheet):
    for dCNum, dCName, audithory in sheet:
        if audithory.value:
            audithoryValue = audithory.value
            if "с/з" in audithoryValue:
                audithoryValue = audithoryValue.replace("с/з,", "с/з")
            audithory = audithoryValue.replace("\n", "").split(",")[:-1]
            audithory = "\n".join(audithory)
            list.append([dCNum.value, dCName.value, "___________", audithory])
        else:
            list.append([dCNum.value, "", "___________", ""])
    return list

def ListJoin(list, fileName):
    for i in range(len(list)):
        list[i] = "\n".join(map(str, list[i]))
    list = "\n\n".join(map(str, list))
    with open(fileName, "w") as openedFile:
        openedFile.write(list)

def ZipFileOpen(archiveName):
    with ZipFile(archiveName, "w") as archive:
        archive.write("monday.txt")
        archive.write("tuesday.txt")
        archive.write("wednesday.txt")
        archive.write("thursday.txt")
        archive.write("friday.txt")
        archive.write("saturday.txt")

def RemoveTxtFiles(monday, tuesday, wednesday, thursday ,friday, saturday):
    os.remove(monday)
    os.remove(tuesday)
    os.remove(wednesday)
    os.remove(thursday)
    os.remove(friday)
    os.remove(saturday)

def Schedule284Create():
    sheet = OpenXlsxFile("284_s_yanv.xlsx").active
    indexOfDay = GetIndexOfDay(sheet)

    text = list()
    mondaySchedule = sheet.iter_rows(min_row=indexOfDay[0], max_row=indexOfDay[1] - 1, min_col=2, max_col=4)
    Redactor(text, mondaySchedule)
    ListJoin(text, "monday.txt")

    text = list()
    tuesdaySchedule = sheet.iter_rows(min_row=indexOfDay[1], max_row=indexOfDay[2] - 1, min_col=2, max_col=4)
    Redactor(text, tuesdaySchedule)
    ListJoin(text, "tuesday.txt")

    text = list()
    wednesdaySchedule = sheet.iter_rows(min_row=indexOfDay[2], max_row=indexOfDay[3] - 1, min_col=2, max_col=4)
    Redactor(text, wednesdaySchedule)
    ListJoin(text, "wednesday.txt")

    text = list()
    thursdaySchedule = sheet.iter_rows(min_row=indexOfDay[3], max_row=indexOfDay[4] - 1, min_col=2, max_col=4)
    Redactor(text, thursdaySchedule)
    ListJoin(text, "thursday.txt")

    text = list()
    fridaySchedule = sheet.iter_rows(min_row=indexOfDay[4], max_row=indexOfDay[5] - 1, min_col=2, max_col=4)
    Redactor(text, fridaySchedule)
    ListJoin(text, "friday.txt")

    text = list()
    saturdaySchedule = sheet.iter_rows(min_row=indexOfDay[5], max_row=indexOfDay[6] - 1, min_col=2, max_col=4)
    Redactor(text, saturdaySchedule)
    ListJoin(text, "saturday.txt")

    ZipFileOpen("284.zip")

    RemoveTxtFiles("monday.txt", "tuesday.txt", "wednesday.txt", "thursday.txt", "friday.txt", "saturday.txt")


Schedule284Create()